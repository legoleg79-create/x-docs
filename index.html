<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Тарифы Ozon — Отправка из Омска (ПВЗ)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #fff;
      color: #000;
    }
    .header-link {
      margin-bottom: 15px;
      font-size: 16px;
    }
    .header-link a {
      color: #1976d2;
      text-decoration: none;
    }
    .header-link a:hover {
      text-decoration: underline;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
      font-size: 13px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px 10px;
      text-align: left;
    }
    th {
      background-color: #f4f4f4;
      position: sticky;
      top: 0;
      cursor: pointer;
      user-select: none;
    }
    th:hover {
      background-color: #e9e9e9;
    }
    th::after {
      content: " ⇵";
      color: #888;
      font-size: 10px;
    }
    th.sort-asc::after {
      content: " ↑";
      color: #000;
    }
    th.sort-desc::after {
      content: " ↓";
      color: #000;
    }
    select {
      margin: 5px 10px 5px 0;
      padding: 6px;
      font-size: 13px;
      min-width: 180px;
    }
    .filters {
      background: #f9f9f9;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: end;
    }
    .diff-up { color: #d32f2f; font-weight: bold; }
    .diff-down { color: #2e7d32; font-weight: bold; }
    .diff-zero { color: #555; }
    button {
      padding: 6px 12px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover { background: #45a049; }
  </style>
</head>
<body>

<div class="header-link">
  Создано: <a href="https://t.me/G_ozon" target="_blank">Гозон — уютное бухтение про озон</a>
</div>

<h2>Тарифы Ozon — Приём на ПВЗ (литры)<br>
Сравнение: 03.07.2025 → 06.11.2025<br>
<i>Отправка из тарифной зоны: <b>Омск</b> (только ПВЗ)</i></h2>

<div class="filters">
  <div>
    <label>Кластер получатель:<br>
      <select id="filter-cluster"><option value="">Все</option></select>
    </label>
  </div>
  <div>
    <label>Склад получатель:<br>
      <select id="filter-warehouse"><option value="">Все</option></select>
    </label>
  </div>
  <button onclick="resetFilters()">Сбросить фильтры</button>
</div>

<table id="tariffTable">
  <thead>
    <tr>
      <th data-column="0" onclick="sortTable(0)">Кластер получатель</th>
      <th data-column="1" onclick="sortTable(1)">Склад получатель</th>
      <th data-column="2" onclick="sortTable(2)">Старая цена (руб/л)</th>
      <th data-column="3" onclick="sortTable(3)">Новая цена (руб/л)</th>
      <th data-column="4" onclick="sortTable(4)">Разница (руб)</th>
      <th data-column="5" onclick="sortTable(5)">Изменение (%)</th>
    </tr>
  </thead>
  <tbody>
    <!-- Заполняется скриптом -->
  </tbody>
</table>

<script>
  // === ДАННЫЕ: отправка из Омска, только ПВЗ ===
  // Формат: [cluster, warehouse, oldPrice, newPrice, diff, pctChange]
  const rawData = [
["Краснодар","Адыгейск РФЦ",9.9,11.9],
["Казахстан","Алматы 2 РФЦ",10,12],
["Казахстан","Астана РФЦ",10,12],
["Саратов","Волгоград МРФЦ",10,12],
["Воронеж","Воронеж МРФЦ",10,12],
["Воронеж","Воронеж-2 РФЦ",10,12],
["Москва, МО и Дальние регионы","Гривно РФЦ",8.5,10.2],
["Москва, МО и Дальние регионы","Домодедово РФЦ",8.5,10.2],
["Екатеринбург","Екатеринбург РФЦ",4.2,5.1],
["Казань","Казань РФЦ",5,6],
["Калининград","Калининград МРФЦ",24,28.8],
["Красноярск","Красноярск МРФЦ",5,6],
["Кавказ","Махачкала РФЦ",16,19.2],
["Беларусь","Минск МПСЦ",13,15.6],
["Кавказ","Невинномысск РФЦ",16,19.2],
["Казань","Нижний Новгород РФЦ",5,6],
["Краснодар","Новороссийск МРФЦ",9.9,11.9],
["Новосибирск","Новосибирск РФЦ",3.1,3.8],
["Москва, МО и Дальние регионы","Ногинск РФЦ",8.5,10.2],
["Омск","Омск РФЦ",3.1,3.8],
["Оренбург","Оренбург РФЦ",6,7.2],
["Пермь","Пермь РФЦ",4.2,5.1],
["Москва, МО и Дальние регионы","Петровское РФЦ",8.5,10.2],
["Москва, МО и Дальние регионы","Пушкино-1 РФЦ",8.5,10.2],
["Москва, МО и Дальние регионы","Пушкино-2 РФЦ",8.5,10.2],
["Ростов","Ростов-На-Дону РФЦ",9.9,11.9],
["Самара","Самара РФЦ",5,6],
["Санкт-Петербург и СЗО","Санкт-Петербург РФЦ",6.2,7.5],
["Саратов","Саратов РФЦ",10,12],
["Москва, МО и Дальние регионы","Софьино РФЦ",8.5,10.2],
["Санкт-Петербург и СЗО","СПБ Бугры РФЦ",6.2,7.5],
["Санкт-Петербург и СЗО","СПБ Колпино РФЦ",6.2,7.5],
["Санкт-Петербург и СЗО","СПБ Шушары РФЦ",6.2,7.5],
["Тверь","Тверь РФЦ",8.5,10.2],
["Тюмень","Тюмень РФЦ",3,3.6],
["Уфа","Уфа РФЦ",6,7.2],
["Дальний Восток","Хабаровск-2 РФЦ",10,12],
["Москва, МО и Дальние регионы","Хоругвино РФЦ",8.5,10.2],
["Ярославль","Ярославль РФЦ",14.4,17.3]
  ];

  // Подготавливаем данные с числовыми diff и pct
  const data = rawData.map(row => {
    const [cluster, warehouse, oldPrice, newPrice] = row;
    const diff = newPrice - oldPrice;
    const pctChange = oldPrice > 0 ? ((newPrice - oldPrice) / oldPrice * 100) : 0;
    return { cluster, warehouse, oldPrice, newPrice, diff, pctChange };
  });

  let currentSort = { column: null, direction: 'asc' };
  let filteredData = [...data];

  function populateFilters() {
    const clusters = new Set();
    const warehouses = new Set();

    data.forEach(row => {
      clusters.add(row.cluster);
      warehouses.add(row.warehouse);
    });

    const clusterSelect = document.getElementById('filter-cluster');
    const warehouseSelect = document.getElementById('filter-warehouse');

    Array.from(clusters).sort().forEach(c => {
      const opt = document.createElement('option');
      opt.value = c;
      opt.textContent = c;
      clusterSelect.appendChild(opt);
    });
    Array.from(warehouses).sort().forEach(w => {
      const opt = document.createElement('option');
      opt.value = w;
      opt.textContent = w;
      warehouseSelect.appendChild(opt);
    });
  }

  function renderTable(dataToShow = filteredData) {
    const tbody = document.querySelector('#tariffTable tbody');
    tbody.innerHTML = '';
    dataToShow.forEach(row => {
      const diffClass = row.diff > 0 ? 'diff-up' : row.diff < 0 ? 'diff-down' : 'diff-zero';
      const diffText = row.diff >= 0 ? `+${row.diff.toFixed(1)}` : row.diff.toFixed(1);
      const pctText = row.pctChange >= 0 ? `+${row.pctChange.toFixed(1)}%` : `${row.pctChange.toFixed(1)}%`;

      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${row.cluster}</td>
        <td>${row.warehouse}</td>
        <td>${row.oldPrice.toFixed(1)}</td>
        <td>${row.newPrice.toFixed(1)}</td>
        <td class="${diffClass}">${diffText}</td>
        <td class="${diffClass}">${pctText}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  function sortTable(columnIndex) {
    const direction = (currentSort.column === columnIndex && currentSort.direction === 'asc') ? 'desc' : 'asc';
    currentSort = { column: columnIndex, direction };

    // Сброс индикаторов
    document.querySelectorAll('th').forEach(th => {
      th.classList.remove('sort-asc', 'sort-desc');
    });
    document.querySelector(`th[data-column="${columnIndex}"]`).classList.add(direction === 'asc' ? 'sort-asc' : 'sort-desc');

    filteredData.sort((a, b) => {
      let valA, valB;

      switch(columnIndex) {
        case 0: valA = a.cluster; valB = b.cluster; break;
        case 1: valA = a.warehouse; valB = b.warehouse; break;
        case 2: valA = a.oldPrice; valB = b.oldPrice; break;
        case 3: valA = a.newPrice; valB = b.newPrice; break;
        case 4: valA = a.diff; valB = b.diff; break;
        case 5: valA = a.pctChange; valB = b.pctChange; break;
        default: return 0;
      }

      if (typeof valA === 'string') {
        return direction === 'asc' ? valA.localeCompare(valB) : valB.localeCompare(valA);
      } else {
        return direction === 'asc' ? valA - valB : valB - valA;
      }
    });

    renderTable(filteredData);
  }

  function applyFilters() {
    const cluster = document.getElementById('filter-cluster').value;
    const warehouse = document.getElementById('filter-warehouse').value;

    filteredData = data.filter(row =>
      (cluster === '' || row.cluster === cluster) &&
      (warehouse === '' || row.warehouse === warehouse)
    );

    if (currentSort.column !== null) {
      sortTable(currentSort.column);
    } else {
      renderTable(filteredData);
    }
  }

  function resetFilters() {
    document.getElementById('filter-cluster').value = '';
    document.getElementById('filter-warehouse').value = '';
    filteredData = [...data];
    currentSort = { column: null, direction: 'asc' };
    document.querySelectorAll('th').forEach(th => {
      th.classList.remove('sort-asc', 'sort-desc');
    });
    renderTable();
  }

  document.addEventListener('DOMContentLoaded', () => {
    populateFilters();
    renderTable();
    document.getElementById('filter-cluster').addEventListener('change', applyFilters);
    document.getElementById('filter-warehouse').addEventListener('change', applyFilters);
  });
</script>

</body>
</html>
